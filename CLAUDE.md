# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Graminno is a bilingual (English/Marathi) farm attendance tracking PWA with P2P sync. Built with React 19, TypeScript, Vite 7, and Tailwind CSS 4. Optional Express server enables cross-device sync via Tailscale Funnel.

## Commands

```bash
npm run dev            # Start Vite dev server (http://localhost:5173)
npm run build          # TypeScript compile + Vite build → outputs to docs/
npm run lint           # ESLint check
npm run server         # Start Express sync server (http://localhost:3001)
npm run start          # Build + start server
npm run deploy         # Deploy to GitHub Pages
npm run generate-icons # Regenerate PNG icons from SVG
```

## Architecture

### State Management
- **AppContext** (`src/context/AppContext.tsx`): Global state via React Context
- **localStorage keys**: `graminno-attendance-data`, `graminno-sync-url`, `graminno-sync-status`
- All entities use UUID for IDs

### Data Model (`src/types/index.ts`)
- **Worker**: name, marathiName, dailyRate, status
- **Area**: code, marathiCode, name, marathiName
- **Activity**: code, marathiCode, name, marathiName, category
- **MonthData**: Contains `groups[]` (activity groups with attendance matrices)
- **AttendanceStatus**: 'P' (Present), 'A' (Absent), 'H' (Half-day), '' (Empty)

Activity groups (v2 format) allow multiple independent teams per month. Legacy `days[]` format auto-migrates to groups on load.

### P2P Sync System
- `useAutoSync` hook with 2-second debounce tracks dirty files
- Server stores JSON files in `data/` directory (gitignored)
- Merge uses `modifiedAt` timestamps for conflict resolution
- Works offline; syncs when online or manually triggered

### Key Directories
```
src/
├── pages/           # Route components (Dashboard, Attendance, Workers, etc.)
├── components/ui/   # Reusable UI (Button, Modal, Select, Input)
├── components/layout/  # Layout with sidebar/mobile nav
├── context/         # AppContext for global state
├── hooks/           # useAutoSync, useLocalStorage
├── utils/           # sync.ts, calculations.ts, exporters.ts, transliteration.ts
├── types/           # TypeScript interfaces
└── data/            # translations.ts, sampleData.ts
```

### Bilingual Support
Every UI entity has both English and Marathi variants. Use `useTranslation()` hook for text keys defined in `src/data/translations.ts`.

### PWA Features (vite-plugin-pwa)
- **Service Worker**: Auto-generated by Workbox, precaches all build assets
- **Manifest**: `public/manifest.json` with PNG icons
- **Offline-first**: Full app works offline, data in localStorage
- **Auto-sync**: `useAutoSync` hook syncs dirty files when back online
- **Icons**: SVG source in `public/icons/`, generate PNGs with `npm run generate-icons`

## Build Configuration

- **Base path**: `/farm-attendance/` (for GitHub Pages)
- **Output**: `docs/` folder (GitHub Pages deployment)
- **TypeScript**: Strict mode, noUnusedLocals, noUnusedParameters

## Server Endpoints

Express server (`server.js`) provides:
- `GET/POST /api/workers` - Worker sync
- `GET/POST /api/areas` - Area sync
- `GET/POST /api/activities` - Activity sync
- `GET/POST /api/months` - Monthly attendance sync

Data stored in `data/` directory as JSON files.
